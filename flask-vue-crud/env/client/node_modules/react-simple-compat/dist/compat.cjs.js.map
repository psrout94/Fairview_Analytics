{"version":3,"file":"compat.cjs.js","sources":["../src/Compat.tsx"],"sourcesContent":["import { diff } from \"@egjs/list-differ\";\nimport { IObject, isUndefined, isString, isArray, find } from \"@daybrush/utils\";\n\nfunction isDiff(a: object, b: object) {\n    if (a === b) { return false; }\n    for (const i in a) {\n        if (!(i in b)) {\n            return true;\n        }\n    }\n    for (const i in b) {\n        if (a[i] !== b[i]) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction diffObject(a: object, b: object) {\n    const keys1 = Object.keys(a);\n    const keys2 = Object.keys(b);\n\n    const result = diff(keys1, keys2, key => key);\n\n    const added: IObject<any> = {};\n    const removed: IObject<any> = {};\n    const changed: IObject<any> = {};\n\n    result.added.forEach(index => {\n        const name = keys2[index];\n\n        added[name] = b[name];\n    });\n    result.removed.forEach(index => {\n        const name = keys1[index];\n\n        removed[name] = a[name];\n    });\n    result.maintained.forEach(([index]) => {\n        const name = keys1[index];\n        const values = [a[name], b[name]];\n\n        if (a[name] !== b[name]) {\n            changed[name] = values;\n        }\n    });\n    return {\n        added,\n        removed,\n        changed,\n    };\n}\nfunction executeHooks(hooks: Function[]) {\n    hooks.forEach(hook => {\n        hook();\n    });\n}\nfunction fillKeys(keys: any[]): string[] {\n    let index = 0;\n\n    return keys.map(key => key == null ? `$compat${++index}` : `${key}`);\n}\nfunction createProvider(el: CompatElement | string, key: string, index: number, container?: Provider) {\n    if (isString(el)) {\n        return new TextProvider(`text_${el}`, key, index, container, null, {});\n    }\n    const providerClass\n        = typeof el.type === \"string\"\n            ? ElementProvider\n            : el.type.prototype.render\n                ? ComponentProvider\n                : FunctionProvider;\n\n    return new providerClass(\n        el.type,\n        key,\n        index,\n        container,\n        el.ref,\n        el.props,\n    );\n}\nfunction flat(arr: any[]) {\n    let arr2 = [];\n\n    arr.forEach(el => {\n        arr2 = arr2.concat(isArray(el) ? flat(el) : el);\n    });\n\n    return arr2;\n}\nfunction getAttributes(props: IObject<any>) {\n    const { className, ...otherProps } = props;\n\n    if (className != null) {\n        otherProps.class = className;\n    }\n    delete otherProps.style;\n    delete otherProps.children;\n    return otherProps;\n}\nfunction fillProps(props: IObject<any>, defaultProps: IObject<any>) {\n    if (!defaultProps) {\n        return props;\n    }\n    for (const name in defaultProps) {\n        if (isUndefined(props[name])) {\n            props[name] = defaultProps[name];\n        }\n    }\n    return props;\n}\nexport function createElement(\n    type: any,\n    props: any,\n    ...children: any[]\n): CompatElement {\n    const { key, ref, ...otherProps } = props || {};\n\n    return {\n        type,\n        key,\n        ref,\n        props: { ...otherProps, children: flat(children).filter(child => child != null) },\n    };\n}\nabstract class Provider<T extends Element | Component | Node = Element | Component | Node> {\n    public original: CompatElement | string;\n    public base: T;\n    public _providers: Array<Provider<any>> = [];\n    constructor(\n        public type: any,\n        public key: string,\n        public index: number,\n        public container?: Provider | null,\n        public ref?: (e: Element | Component | Node) => any,\n        public props: IObject<any> = {},\n    ) { }\n    public abstract _render(hooks: Function[], prevProps: any, nextState: any);\n    public abstract _unmount();\n    public _should(nextProps: any, nextState: any): boolean {\n        return true;\n    }\n    public _update(\n        hooks: Function[],\n        nextElement: CompatElement | string,\n        nextState?: any,\n        isForceUpdate?: boolean,\n    ) {\n        if (\n            this.base\n            && !isString(nextElement)\n            && !isForceUpdate\n            && !this._should(nextElement.props, nextState)\n        ) {\n            return false;\n        }\n        this.original = nextElement;\n        this._setState(nextState);\n        // render\n        const prevProps = this.props;\n\n        if (!isString(nextElement)) {\n            this.props = nextElement.props;\n            this.ref = nextElement.ref;\n        }\n        this._render(hooks, this.base ? prevProps : {}, nextState);\n        return true;\n    }\n    public _mounted() {\n        const ref = this.ref;\n        ref && ref(this.base);\n    }\n    public _setState(nextstate: IObject<any>) {\n        return;\n    }\n    public _updated() {\n        const ref = this.ref;\n        ref && ref(this.base);\n    }\n    public _destroy() {\n        const ref = this.ref;\n        ref && ref(null);\n    }\n}\nfunction diffAttributes(attrs1: IObject<any>, attrs2: IObject<any>, el: Element) {\n    const { added, removed, changed } = diffObject(attrs1, attrs2);\n    for (const name in added) {\n        el.setAttribute(name, added[name]);\n    }\n    for (const name in changed) {\n        el.setAttribute(name, changed[name][1]);\n    }\n    for (const name in removed) {\n        el.removeAttribute(name);\n    }\n}\nfunction diffEvents(\n    events1: IObject<any>,\n    events2: IObject<any>,\n    provier: ElementProvider,\n) {\n    const { added, removed, changed } = diffObject(events1, events2);\n\n    for (const name in removed) {\n        provier.removeEventListener(name);\n    }\n    for (const name in added) {\n        provier.addEventListener(name, added[name]);\n    }\n    for (const name in changed) {\n        provier.removeEventListener(name);\n        provier.addEventListener(name, changed[name][1]);\n    }\n    for (const name in removed) {\n        provier.removeEventListener(name);\n    }\n}\nfunction diffStyle(style1: IObject<any>, style2: IObject<any>, el: HTMLElement | SVGElement) {\n    const style = el.style;\n    const { added, removed, changed } = diffObject(style1, style2);\n\n    for (const name in added) {\n        style[name] = added[name];\n    }\n    for (const name in changed) {\n        style[name] = changed[name][1];\n    }\n    for (const name in removed) {\n        style[name] = \"\";\n    }\n}\nfunction splitProps(props: IObject<any>) {\n    const attributes = {};\n    const events = {};\n\n    for (const name in props) {\n        if (name.indexOf(\"on\") === 0) {\n            events[name.replace(\"on\", \"\").toLowerCase()] = props[name];\n        } else {\n            attributes[name] = props[name];\n        }\n    }\n    return {\n        attributes,\n        events,\n    };\n}\nclass TextProvider extends Provider<Node> {\n    public _render(hooks: Function[]) {\n        const isMount = !this.base;\n\n        if (isMount) {\n            this.base = document.createTextNode(this.type.replace(\"text_\", \"\"));\n        }\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n            } else {\n                this._updated();\n            }\n        });\n        return true;\n    }\n    public _unmount() {\n        this.base.parentNode.removeChild(this.base);\n    }\n}\nclass ElementProvider extends Provider<Element> {\n    public events: IObject<Function> = {};\n    public addEventListener(name, callback) {\n        const events = this.events;\n\n        events[name] = e => {\n            e.nativeEvent = e;\n            callback(e);\n        };\n        this.base.addEventListener(name, events[name] as any);\n    }\n    public removeEventListener(name) {\n        const events = this.events;\n\n        this.base.removeEventListener(name, events[name] as any);\n\n        delete events[name];\n    }\n    public _should(nextProps: any) {\n        return isDiff(this.props, nextProps);\n    }\n    public _render(hooks: Function[], prevProps) {\n        const isMount = !this.base;\n\n        if (isMount) {\n            this.base = document.createElement(this.type);\n        }\n        renderProviders(this, this._providers, this.props.children, hooks, null);\n        const base = this.base;\n\n        const {\n            attributes: prevAttributes,\n            events: prevEvents,\n        } = splitProps(prevProps);\n        const {\n            attributes: nextAttributes,\n            events: nextEvents,\n        } = splitProps(this.props);\n        diffAttributes(\n            getAttributes(prevAttributes),\n            getAttributes(nextAttributes),\n            base,\n        );\n        diffEvents(\n            prevEvents,\n            nextEvents,\n            this,\n        );\n        diffStyle(\n            prevProps.style || {},\n            this.props.style || {},\n            base as HTMLElement,\n        );\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n            } else {\n                this._updated();\n            }\n        });\n        return true;\n    }\n    public _unmount() {\n        const events = this.events;\n        const base = this.base;\n        for (const name in events) {\n            base.removeEventListener(name, events[name] as any);\n        }\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n        this.events = {};\n        base.parentNode.removeChild(base);\n    }\n}\nfunction findContainerNode(provider: Provider): Node | null {\n    if (!provider) {\n        return null;\n    }\n    const base = provider.base;\n    if (base instanceof Node) {\n        return base;\n    }\n    return findContainerNode(provider.container);\n}\nexport function findDOMNode(comp: Component | Node | null): Node | null {\n    if (!comp) {\n        return null;\n    }\n    if (comp instanceof Node) {\n        return comp;\n    }\n    const providers = comp._provider._providers;\n    if (!providers.length) {\n        return null;\n    }\n    return findDOMNode(providers[0].base);\n}\nclass FunctionProvider extends Provider<Component> {\n    public _render(hooks: Function[]) {\n        const template = this.type(this.props);\n\n        renderProviders(this, this._providers, template ? [template] : [], hooks);\n        return true;\n    }\n    public _unmount() {\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n    }\n}\nclass ContainerProvider extends Provider<any> {\n    constructor(base: Element) {\n        super(\"container\", \"container\", 0, null);\n        this.base = base;\n    }\n    public _render() {\n        return true;\n    }\n    public _unmount() {\n        return;\n    }\n}\nclass ComponentProvider extends Provider<Component> {\n    constructor(\n        type: typeof Component,\n        key: string,\n        index: number,\n        container: Provider | null,\n        ref: (e: Element | Component | Node) => any,\n        props: IObject<any> = {},\n    ) {\n        super(type, key, index, container, ref, fillProps(props, type.defaultProps));\n    }\n    public _should(nextProps: any, nextState: any) {\n        return this.base.shouldComponentUpdate(\n            fillProps(nextProps, this.type.defaultProps),\n            nextState || this.base.state,\n        );\n    }\n    public _render(hooks: Function[], prevProps, nextState) {\n        this.props = fillProps(this.props, this.type.defaultProps);\n        const isMount = !this.base;\n\n        if (isMount) {\n            this.base = new this.type(this.props);\n            this.base._provider = this;\n        } else {\n            this.base.props = this.props;\n        }\n        const base = this.base;\n        const prevState = base.state;\n        const template = base.render();\n\n        if (template && template.props && !template.props.children.length) {\n            template.props.children = this.props.children;\n        }\n        renderProviders(\n            this,\n            this._providers,\n            template ? [template] : [],\n            hooks,\n            nextState,\n            null,\n        );\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n                base.componentDidMount();\n            } else {\n                this._updated();\n                base.componentDidUpdate(prevProps, prevState);\n            }\n        });\n    }\n    public _setState(nextState?: IObject<any>) {\n        if (!nextState) {\n            return;\n        }\n        const base = this.base;\n        base.state = nextState;\n    }\n    public _unmount() {\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n        this.base.componentWillUnmount();\n    }\n}\nexport class Component {\n    public static defaultProps?: IObject<any>;\n    public _provider: ComponentProvider;\n    public state: IObject<any> = {};\n    constructor(public props: IObject<any> = {}) { }\n    public shouldComponentUpdate(props?: any, state?: any): boolean {\n        return true;\n    }\n    public render() {\n        return null;\n    }\n    public setState(state: IObject<any>, callback?: Function, isForceUpdate?: boolean) {\n        const hooks: Function[] = [];\n        const provider = this._provider;\n\n        const isUpdate = renderProviders(\n            provider.container,\n            [provider],\n            [provider.original],\n            hooks,\n            { ...this.state, ...state },\n            isForceUpdate,\n        );\n        if (isUpdate) {\n            if (callback) {\n                hooks.push(callback);\n            }\n            executeHooks(hooks);\n        }\n    }\n    public forceUpdate(callback?: Function) {\n        this.setState(this.state, callback, true);\n    }\n    public componentDidMount() { }\n    public componentDidUpdate(prevProps, prevState) { }\n    public componentWillUnmount() { }\n\n}\nexport class PureComponent extends Component {\n    public shouldComponentUpdate(props?, state?) {\n        return isDiff(this.props, props) || isDiff(this.state, state);\n    }\n}\nclass _Portal extends PureComponent {\n    public _portalProvider: Provider;\n    public componentDidMount() {\n        const { element, container } = this.props;\n\n        this._portalProvider = new ContainerProvider(container);\n\n        renderProvider(element, container, this._portalProvider);\n    }\n    public componentDidUpdate() {\n        const { element, container } = this.props;\n\n        renderProvider(element, container, this._portalProvider);\n    }\n    public componentWillUnmount() {\n        const { container } = this.props;\n\n        renderProvider(null, container, this._portalProvider);\n        this._portalProvider = null;\n    }\n}\nfunction updateProvider(\n    provider: Provider,\n    children: Array<CompatElement | string>,\n    nextState?: any,\n) {\n    const hooks: Function[] = [];\n    renderProviders(\n        provider,\n        provider._providers,\n        children,\n        hooks,\n        nextState,\n    );\n    executeHooks(hooks);\n}\nfunction getNextSibiling(\n    provider: Provider,\n    childProvider: Provider,\n) {\n    const childProviders = provider._providers;\n    const length = childProviders.length;\n\n    for (let i = childProvider.index + 1; i < length; ++i) {\n        const el = findDOMNode(childProviders[i].base);\n\n        if (el) {\n            return el;\n        }\n    }\n    return null;\n}\nfunction diffProviders(\n    containerProvider: Provider,\n    providers: Provider[],\n    children: Array<CompatElement | string>,\n) {\n    const childrenKeys = children.map(p => isString(p) ? null : p.key);\n    const keys1 = fillKeys(providers.map(p => p.key));\n    const keys2 = fillKeys(childrenKeys);\n    const result = diff(keys1, keys2, key => key);\n\n    result.removed.forEach(index => {\n        providers.splice(index, 1)[0]._unmount();\n    });\n    result.ordered.forEach(([from, to]) => {\n        const childrenProvider = providers.splice(from, 1)[0];\n\n        providers.splice(to, 0, childrenProvider);\n\n        const el = findDOMNode(childrenProvider.base);\n        const next = findDOMNode(providers[to + 1] && providers[to + 1].base);\n\n        if (el) {\n            el.parentNode.insertBefore(el, next);\n        }\n    });\n    result.added.forEach(index => {\n        providers.splice(index, 0, createProvider(children[index], childrenKeys[index], index, containerProvider));\n    });\n    const changed = result.maintained.filter(([_, to]) => {\n        const el = children[to];\n        const childProvider = providers[to];\n        const type = isString(el) ? `text_${el}` : el.type;\n\n        if (type !== childProvider.type) {\n            childProvider._unmount();\n            providers.splice(to, 1, createProvider(el, childrenKeys[to], to, containerProvider));\n            return true;\n        }\n        childProvider.index = to;\n        return false;\n    });\n\n    return [\n        ...result.added,\n        ...changed.map(([_, to]) => to),\n    ];\n}\nfunction renderProviders(\n    containerProvider: Provider | null,\n    providers: Provider[],\n    children: Array<CompatElement | string>,\n    updatedHooks: Function[],\n    nextState?: any,\n    isForceUpdate?: boolean,\n) {\n    const result = diffProviders(containerProvider, providers, children);\n    const updated = providers.filter((childProvider, i) => {\n        return childProvider._update(updatedHooks, children[i], nextState, isForceUpdate);\n    });\n    const containerNode = findContainerNode(containerProvider);\n\n    if (containerNode) {\n        result.reverse().forEach(index => {\n            const childProvider = providers[index];\n            const el = findDOMNode(childProvider.base);\n\n            if (!el) {\n                return;\n            }\n            if (containerNode !== el && !el.parentNode) {\n                const nextElement = getNextSibiling(containerProvider, childProvider);\n                containerNode.insertBefore(el, nextElement);\n            }\n        });\n    }\n    return updated.length > 0;\n}\nfunction renderProvider(\n    element: any,\n    container: Element,\n    provider: Provider = (container as any).__REACT_COMPAT__,\n) {\n    const isProvider = !!provider;\n\n    if (!provider) {\n        provider = new ContainerProvider(container);\n    }\n    updateProvider(provider, element ? [element] : []);\n\n    if (!isProvider) {\n        (container as any).__REACT_COMPAT__ = provider;\n    }\n    return provider;\n}\nexport function render(element: any, container: Element, callback?: Function) {\n    const provider = (container as any).__REACT_COMPAT__;\n    if (element && !provider) {\n        container.innerHTML = \"\";\n    }\n    renderProvider(element, container, provider);\n    callback && callback();\n}\n\nexport function createPortal(el: any, container: Element) {\n    return <_Portal element={el} container={container} />;\n}\n"],"names":["isDiff","a","b","i","diffObject","keys1","Object","keys","keys2","result","diff","key","added","removed","changed","forEach","index","name","maintained","_a","values","executeHooks","hooks","hook","fillKeys","map","createProvider","el","container","isString","TextProvider","providerClass","type","ElementProvider","prototype","render","ComponentProvider","FunctionProvider","ref","props","flat","arr","arr2","concat","isArray","getAttributes","className","otherProps","class","style","children","fillProps","defaultProps","isUndefined","createElement","_i","filter","child","nextProps","nextState","nextElement","isForceUpdate","base","_should","original","_setState","prevProps","_render","nextstate","diffAttributes","attrs1","attrs2","setAttribute","removeAttribute","diffEvents","events1","events2","provier","removeEventListener","addEventListener","diffStyle","style1","style2","splitProps","attributes","events","indexOf","replace","toLowerCase","__extends","isMount","document","createTextNode","push","_this","_mounted","_updated","parentNode","removeChild","Provider","callback","e","nativeEvent","renderProviders","_providers","prevAttributes","prevEvents","_b","nextAttributes","nextEvents","provider","_unmount","findContainerNode","Node","findDOMNode","comp","providers","_provider","length","template","_super","shouldComponentUpdate","state","prevState","componentDidMount","componentDidUpdate","componentWillUnmount","isUpdate","setState","Component","element","_portalProvider","ContainerProvider","renderProvider","PureComponent","updateProvider","getNextSibiling","childProvider","childProviders","diffProviders","containerProvider","childrenKeys","p","splice","ordered","from","to","childrenProvider","next","insertBefore","_","updatedHooks","updated","_update","containerNode","reverse","__REACT_COMPAT__","isProvider","innerHTML","createPortal","_Portal"],"mappings":"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"}