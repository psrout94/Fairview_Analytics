{"version":3,"file":"styled.esm.js","sources":["../src/utils.ts","../src/styled.ts"],"sourcesContent":["import stringHash from \"string-hash\";\nimport { splitComma } from \"@daybrush/utils\";\n\nexport function getHash(str: string) {\n  return stringHash(str).toString(36);\n}\nexport function getShadowRoot(parentElement: HTMLElement | SVGElement) {\n    if (parentElement.getRootNode) {\n        const rootNode = parentElement.getRootNode();\n\n        if (rootNode.nodeType === 11) {\n            return rootNode;\n        }\n    }\n    return;\n}\nexport function injectStyle(className: string, css: string, shadowRoot?: Node) {\n  const style = document.createElement(\"style\");\n\n  style.setAttribute(\"type\", \"text/css\");\n  style.innerHTML = css.replace(/([^}{]*){/mg, (all, selector) => {\n    return splitComma(selector).map(subSelector => {\n      if (subSelector.indexOf(\":global\") > -1) {\n        return subSelector.replace(/\\:global/g, \"\");\n      } else if (subSelector.indexOf(\":host\") > -1) {\n        return `${subSelector.replace(/\\:host/g, `.${className}`)}`;\n      }\n      return `.${className} ${subSelector}`;\n    }).join(\", \") + \"{\";\n  });\n\n  (shadowRoot || document.head || document.body).appendChild(style);\n  return style;\n}\n","import { getHash, injectStyle, getShadowRoot } from \"./utils\";\nimport { StyledInjector } from \"./types\";\n\nexport default function styled(css: string): StyledInjector {\n    const injectClassName = \"rCS\" + getHash(css);\n    let injectCount = 0;\n    let injectElement!: HTMLStyleElement;\n\n    return {\n        className: injectClassName,\n        inject(el: HTMLElement | SVGElement) {\n            const shadowRoot = getShadowRoot(el);\n            const firstMount = injectCount === 0;\n            let styleElement: HTMLStyleElement;\n\n            if (shadowRoot || firstMount) {\n                styleElement = injectStyle(injectClassName, css, shadowRoot);\n            }\n            if (firstMount) {\n                injectElement = styleElement;\n              }\n            if (!shadowRoot) {\n                ++injectCount;\n            }\n            return {\n                destroy() {\n                    if (shadowRoot) {\n                        el.removeChild(styleElement);\n                        styleElement = null;\n                    } else {\n                        if (injectCount > 0) {\n                            --injectCount;\n                        }\n                        if (injectCount === 0 && injectElement) {\n                            injectElement.parentNode!.removeChild(injectElement);\n                            injectElement = null;\n                        }\n                    }\n                },\n            };\n        },\n    };\n}\n\nexport * from \"./types\";\n"],"names":["getHash","str","stringHash","toString","getShadowRoot","parentElement","getRootNode","rootNode","nodeType","injectStyle","className","css","shadowRoot","style","document","createElement","setAttribute","innerHTML","replace","all","selector","splitComma","map","subSelector","indexOf","join","head","body","appendChild","styled","injectClassName","injectCount","injectElement","inject","el","firstMount","styleElement","destroy","removeChild","parentNode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;SAGgBA,QAAQC;SACfC,UAAU,CAACD,GAAD,CAAV,CAAgBE,QAAhB,CAAyB,EAAzB,CAAP;;AAEF,SAAgBC,cAAcC;MACtBA,aAAa,CAACC,WAAlB,EAA+B;QACrBC,QAAQ,GAAGF,aAAa,CAACC,WAAd,EAAjB;;QAEIC,QAAQ,CAACC,QAAT,KAAsB,EAA1B,EAA8B;aACnBD,QAAP;;;;;;AAKZ,SAAgBE,YAAYC,WAAmBC,KAAaC;MACpDC,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAd;EAEAF,KAAK,CAACG,YAAN,CAAmB,MAAnB,EAA2B,UAA3B;EACAH,KAAK,CAACI,SAAN,GAAkBN,GAAG,CAACO,OAAJ,CAAY,aAAZ,EAA2B,UAACC,GAAD,EAAMC,QAAN;WACpCC,UAAU,CAACD,QAAD,CAAV,CAAqBE,GAArB,CAAyB,UAAAC,WAAA;UAC1BA,WAAW,CAACC,OAAZ,CAAoB,SAApB,IAAiC,CAAC,CAAtC,EAAyC;eAChCD,WAAW,CAACL,OAAZ,CAAoB,WAApB,EAAiC,EAAjC,CAAP;OADF,MAEO,IAAIK,WAAW,CAACC,OAAZ,CAAoB,OAApB,IAA+B,CAAC,CAApC,EAAuC;eACrC,KAAGD,WAAW,CAACL,OAAZ,CAAoB,SAApB,EAA+B,MAAIR,SAAnC,CAAV;;;aAEK,MAAIA,SAAJ,MAAA,GAAiBa,WAAxB;KANK,EAOJE,IAPI,CAOC,IAPD,IAOS,GAPhB;GADgB,CAAlB;GAWCb,UAAU,IAAIE,QAAQ,CAACY,IAAvB,IAA+BZ,QAAQ,CAACa,IAAzC,EAA+CC,WAA/C,CAA2Df,KAA3D;SACOA,KAAP;;;SC7BsBgB,OAAOlB;MACrBmB,eAAe,GAAG,QAAQ9B,OAAO,CAACW,GAAD,CAAvC;MACIoB,WAAW,GAAG,CAAlB;MACIC,aAAJ;SAEO;IACHtB,SAAS,EAAEoB,eADR;IAEHG,MAAM,EAAN,UAAOC,EAAP;UACUtB,UAAU,GAAGR,aAAa,CAAC8B,EAAD,CAAhC;UACMC,UAAU,GAAGJ,WAAW,KAAK,CAAnC;UACIK,YAAJ;;UAEIxB,UAAU,IAAIuB,UAAlB,EAA8B;QAC1BC,YAAY,GAAG3B,WAAW,CAACqB,eAAD,EAAkBnB,GAAlB,EAAuBC,UAAvB,CAA1B;;;UAEAuB,UAAJ,EAAgB;QACZH,aAAa,GAAGI,YAAhB;;;UAEA,CAACxB,UAAL,EAAiB;UACXmB,WAAF;;;aAEG;QACHM,OAAO,EAAP;cACQzB,UAAJ,EAAgB;YACZsB,EAAE,CAACI,WAAH,CAAeF,YAAf;YACAA,YAAY,GAAG,IAAf;WAFJ,MAGO;gBACCL,WAAW,GAAG,CAAlB,EAAqB;gBACfA,WAAF;;;gBAEAA,WAAW,KAAK,CAAhB,IAAqBC,aAAzB,EAAwC;cACpCA,aAAa,CAACO,UAAd,CAA0BD,WAA1B,CAAsCN,aAAtC;cACAA,aAAa,GAAG,IAAhB;;;;OAXhB;;GAhBR;;;;;"}